<%- content_for :javascript_includes do -%>
<%#= GMap.header :host => request.headers["SERVER_NAME"] %>
<%#= @map.to_html %>
<%- end -%>

<div id="gutter">
<%= link_to '<strong>+</strong> Add a New Event', new_event_path %>
</div>
<div class="bg_container">
  <div class="container_12">
    <div id="tab" class="grid_4">
      <div class="inner">
        <h1><%= link_to "Rubyholic", :controller => "events", :action => "index" %></h1>
      </div>
    </div>
    <div id="recommended" class="grid_4">
      <%= render :partial => 'group_recommendations' %>
      <%= render :partial => 'location_recommendations' %>
    </div>
    
    <%#= @map.div :width => '100%', :height => 490 %>
    
    <div class="grid_8">
      <h2>Search Results</h2>

      <form action="<%= url_for(:controller => '/search', :action => 'index') %>" method="get" id="form_search">
        <!-- <label for="search_query">Search Groups</label> -->
        <input type="text" size="30" id="search_query" name="q" value="<%= @query %>" />
        <button type="submit">Search</button>
      </form>

      <% if @search.empty? %>
      There are no search results for "<%= @query %>".
      <% else %>
      <h3>There are <%= @search.size %> results for "<%= @query %>"</h3>
      <table>
        <tr>
          <th>Group Name</th>
          <th>Date</th>
          <th>Description</th>
          <th>Location</th>
          <th>Address</th>
          <th>Distance</th>
        </tr>

        <% @search.each_with_geodist do |result, distance| %>
        <tr>
          <td><%= link_to result.group.name, result %></td>
          <td><%= result.start_time.strftime("%d %b %Y") %></td>
          <td><%= truncate(result.description, :length => 75) %></td>
          <td><%= result.location.name %></td>
          <td><%= result.location.address %> [<%= result.location.latitude %>, <%= result.location.longitude %>]</td>
          <td><%= number_with_delimiter number_with_precision(distance, 0) %></td>
        </tr>
        <%- end -%>
      </table>
      <br />
      <%= will_paginate @search %>
      <%- end -%>
    </div>
  </div>
</div>